<!DOCTYPE html>
<!--
  åˆ¶ä½œè€…ï¼šYN
  æ—¥æœŸï¼š2025-11-28
  ç‰ˆæœ¬ï¼šv2.0 - ç°ä»£åŒ–UIé‡æ„ç‰ˆ
-->
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æç¤ºè¯ç®¡ç†å·¥å…·</title>
    <style>
        :root {
            /* ä¸»è‰²ç³» - æ›´ç°ä»£çš„é…è‰² */
            --primary-color: #6366f1;
            --primary-dark: #4f46e5;
            --primary-light: #818cf8;
            --success-color: #10b981;
            --success-dark: #059669;
            --warning-color: #f59e0b;
            --warning-dark: #d97706;
            --danger-color: #ef4444;
            --danger-dark: #dc2626;
            --info-color: #3b82f6;
            --info-dark: #2563eb;

            /* ä¸­æ€§è‰²ç³» */
            --background-color: #f8fafc;
            --surface-color: #ffffff;
            --border-color: #e2e8f0;
            --border-light: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --text-inverse: #ffffff;

            /* æš—è‰²ä¸»é¢˜ */
            --dark-background: #0f172a;
            --dark-surface: #1e293b;
            --dark-surface-light: #334155;
            --dark-border: #334155;
            --dark-text-primary: #f1f5f9;
            --dark-text-secondary: #cbd5e1;
            --dark-text-muted: #94a3b8;

            /* é—´è·ç³»ç»Ÿ */
            --spacing-xs: 4px;
            --spacing-sm: 8px;
            --spacing-md: 12px;
            --spacing-lg: 16px;
            --spacing-xl: 20px;
            --spacing-xxl: 24px;
            --spacing-xxxl: 32px;

            /* å­—ä½“ç³»ç»Ÿ */
            --font-size-xs: 12px;
            --font-size-sm: 14px;
            --font-size-md: 16px;
            --font-size-lg: 18px;
            --font-size-xl: 20px;
            --font-size-xxl: 24px;
            --font-size-xxxl: 32px;

            /* åœ†è§’ç³»ç»Ÿ */
            --radius-sm: 6px;
            --radius-md: 8px;
            --radius-lg: 12px;
            --radius-xl: 16px;
            --radius-full: 9999px;

            /* é˜´å½±ç³»ç»Ÿ */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--background-color);
            color: var(--text-primary);
            font-size: var(--font-size-md);
            line-height: 1.6;
            transition: background-color 0.3s ease, color 0.3s ease;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        body.dark-theme {
            background: var(--dark-background);
            color: var(--dark-text-primary);
        }

        /* å®¹å™¨ */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--spacing-xl);
        }

        /* å¤´éƒ¨ */
        .header {
            background: var(--surface-color);
            border-radius: var(--radius-xl);
            padding: var(--spacing-xxl);
            margin-bottom: var(--spacing-xl);
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
        }

        body.dark-theme .header {
            background: var(--dark-surface);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: var(--spacing-lg);
        }

        .header-left {
            flex: 1;
        }

        .header-title {
            font-size: var(--font-size-xxxl);
            font-weight: 700;
            margin-bottom: var(--spacing-sm);
            background: linear-gradient(135deg, var(--primary-color), var(--info-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-subtitle {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
        }

        body.dark-theme .header-subtitle {
            color: var(--dark-text-secondary);
        }

        /* å¤´éƒ¨æ§åˆ¶æŒ‰é’®ç»„ */
        .header-controls {
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
        }

        /* çŠ¶æ€æŒ‡ç¤ºå™¨ */
        .status-indicator {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
            padding: var(--spacing-sm) var(--spacing-lg);
            background: var(--background-color);
            border-radius: var(--radius-full);
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }

        body.dark-theme .status-indicator {
            background: var(--dark-background);
            color: var(--dark-text-secondary);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--text-muted);
        }

        .status-dot.online {
            background: var(--success-color);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* æŒ‰é’®ç»„ */
        .btn-group {
            display: flex;
            gap: var(--spacing-sm);
        }

        .btn {
            padding: var(--spacing-sm) var(--spacing-lg);
            border: none;
            border-radius: var(--radius-md);
            cursor: pointer;
            font-weight: 500;
            font-size: var(--font-size-sm);
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: var(--spacing-xs);
            min-height: 36px;
            white-space: nowrap;
        }

        .btn:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: var(--primary-color);
            color: var(--text-inverse);
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-success {
            background: var(--success-color);
            color: var(--text-inverse);
        }

        .btn-success:hover {
            background: var(--success-dark);
        }

        .btn-secondary {
            background: var(--border-color);
            color: var(--text-primary);
        }

        body.dark-theme .btn-secondary {
            background: var(--dark-border);
            color: var(--dark-text-primary);
        }

        .btn-secondary:hover {
            background: var(--text-muted);
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            padding: 0;
            border-radius: var(--radius-full);
            background: var(--background-color);
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        body.dark-theme .btn-icon {
            background: var(--dark-background);
            color: var(--dark-text-primary);
            border-color: var(--dark-border);
        }

        .btn-icon:hover {
            background: var(--primary-color);
            color: var(--text-inverse);
            border-color: var(--primary-color);
        }

        /* å·¥å…·æ  */
        .toolbar {
            background: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            box-shadow: var(--shadow-sm);
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            align-items: center;
        }

        body.dark-theme .toolbar {
            background: var(--dark-surface);
        }

        .search-box {
            flex: 1;
            min-width: 200px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: var(--spacing-sm) var(--spacing-md) var(--spacing-sm) 40px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            background: var(--background-color);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        body.dark-theme .search-input {
            background: var(--dark-background);
            color: var(--dark-text-primary);
            border-color: var(--dark-border);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .search-icon {
            position: absolute;
            left: var(--spacing-md);
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
            pointer-events: none;
        }

        .filter-group {
            display: flex;
            gap: var(--spacing-sm);
            align-items: center;
        }

        .select-control {
            padding: var(--spacing-sm) var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            background: var(--background-color);
            color: var(--text-primary);
            cursor: pointer;
            min-width: 120px;
        }

        body.dark-theme .select-control {
            background: var(--dark-background);
            color: var(--dark-text-primary);
            border-color: var(--dark-border);
        }

        .select-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        /* æç¤ºè¯ç½‘æ ¼ */
        .prompts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: var(--spacing-lg);
        }

        .prompt-card {
            background: var(--surface-color);
            border: 2px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        body.dark-theme .prompt-card {
            background: var(--dark-surface);
            border-color: var(--dark-border);
        }

        .prompt-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-color);
        }

        .prompt-card.private {
            border-left: 4px solid var(--warning-color);
        }

        .prompt-card.public {
            border-left: 4px solid var(--success-color);
        }

        .prompt-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: var(--spacing-md);
            gap: var(--spacing-sm);
        }

        .prompt-title {
            font-size: var(--font-size-lg);
            font-weight: 600;
            color: var(--text-primary);
            flex: 1;
            word-break: break-word;
        }

        body.dark-theme .prompt-title {
            color: var(--dark-text-primary);
        }

        .prompt-badges {
            display: flex;
            gap: var(--spacing-xs);
            flex-shrink: 0;
        }

        .badge {
            padding: 2px 8px;
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
            font-weight: 600;
            white-space: nowrap;
        }

        .badge-private {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning-dark);
        }

        .badge-public {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-dark);
        }

        .badge-pinned {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary-dark);
        }

        .prompt-content {
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            line-height: 1.6;
            margin-bottom: var(--spacing-md);
            max-height: 100px;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 4;
            -webkit-box-orient: vertical;
        }

        body.dark-theme .prompt-content {
            color: var(--dark-text-secondary);
        }

        .prompt-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: var(--spacing-md);
            border-top: 1px solid var(--border-light);
        }

        body.dark-theme .prompt-footer {
            border-top-color: var(--dark-border);
        }

        .prompt-meta {
            display: flex;
            gap: var(--spacing-md);
            font-size: var(--font-size-xs);
            color: var(--text-muted);
        }

        .prompt-actions {
            display: flex;
            gap: var(--spacing-xs);
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: var(--font-size-xs);
            min-height: 28px;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: var(--spacing-xxxl) var(--spacing-xl);
            color: var(--text-muted);
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: var(--spacing-lg);
            opacity: 0.5;
        }

        .empty-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
            margin-bottom: var(--spacing-sm);
            color: var(--text-secondary);
        }

        body.dark-theme .empty-title {
            color: var(--dark-text-secondary);
        }

        .empty-text {
            font-size: var(--font-size-sm);
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: var(--spacing-lg);
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--surface-color);
            border-radius: var(--radius-xl);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
            animation: modalSlideIn 0.3s ease-out;
        }

        body.dark-theme .modal-content {
            background: var(--dark-surface);
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: var(--spacing-xl);
            border-bottom: 1px solid var(--border-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        body.dark-theme .modal-header {
            border-bottom-color: var(--dark-border);
        }

        .modal-title {
            font-size: var(--font-size-xl);
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: var(--font-size-xl);
            cursor: pointer;
            color: var(--text-muted);
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
        }

        .modal-close:hover {
            background: var(--background-color);
            color: var(--text-primary);
        }

        body.dark-theme .modal-close:hover {
            background: var(--dark-background);
            color: var(--dark-text-primary);
        }

        .modal-body {
            padding: var(--spacing-xl);
        }

        .modal-footer {
            padding: var(--spacing-xl);
            border-top: 1px solid var(--border-light);
            display: flex;
            justify-content: flex-end;
            gap: var(--spacing-md);
        }

        body.dark-theme .modal-footer {
            border-top-color: var(--dark-border);
        }

        /* è¡¨å• */
        .form-group {
            margin-bottom: var(--spacing-lg);
        }

        .form-label {
            display: block;
            margin-bottom: var(--spacing-sm);
            font-weight: 500;
            color: var(--text-primary);
            font-size: var(--font-size-sm);
        }

        body.dark-theme .form-label {
            color: var(--dark-text-primary);
        }

        .form-control {
            width: 100%;
            padding: var(--spacing-md);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-md);
            font-size: var(--font-size-sm);
            background: var(--surface-color);
            color: var(--text-primary);
            transition: all 0.2s ease;
        }

        body.dark-theme .form-control {
            background: var(--dark-background);
            color: var(--dark-text-primary);
            border-color: var(--dark-border);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .form-hint {
            margin-top: var(--spacing-xs);
            font-size: var(--font-size-xs);
            color: var(--text-muted);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: var(--primary-color);
        }

        /* Toasté€šçŸ¥ */
        .toast-container {
            position: fixed;
            top: var(--spacing-xl);
            right: var(--spacing-xl);
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
        }

        .toast {
            background: var(--surface-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            box-shadow: var(--shadow-xl);
            min-width: 300px;
            display: flex;
            align-items: center;
            gap: var(--spacing-md);
            animation: toastSlideIn 0.3s ease-out;
        }

        body.dark-theme .toast {
            background: var(--dark-surface);
        }

        @keyframes toastSlideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast-icon {
            font-size: var(--font-size-xl);
            flex-shrink: 0;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 2px;
        }

        .toast-message {
            font-size: var(--font-size-sm);
            color: var(--text-secondary);
        }

        body.dark-theme .toast-message {
            color: var(--dark-text-secondary);
        }

        .toast-close {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-muted);
            padding: 0;
            font-size: var(--font-size-lg);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                padding: var(--spacing-md);
            }

            .header {
                padding: var(--spacing-lg);
            }

            .header-content {
                flex-direction: column;
                align-items: stretch;
            }

            .header-controls {
                justify-content: space-between;
            }

            .header-title {
                font-size: var(--font-size-xxl);
            }

            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }

            .search-box {
                width: 100%;
            }

            .filter-group {
                flex-wrap: wrap;
            }

            .prompts-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                max-width: 100%;
            }

            .toast-container {
                left: var(--spacing-md);
                right: var(--spacing-md);
            }

            .toast {
                min-width: 0;
            }
        }

        @media (max-width: 480px) {
            .header-title {
                font-size: var(--font-size-xl);
            }

            .btn-group {
                flex-wrap: wrap;
            }

            .status-indicator {
                font-size: var(--font-size-xs);
                padding: var(--spacing-xs) var(--spacing-md);
            }
        }

        /* åŠ è½½åŠ¨ç”» */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 0.8s linear infinite;
        }

        body.dark-theme .loading {
            border-color: var(--dark-border);
            border-top-color: var(--primary-color);
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* è¯¦æƒ…æ¨¡æ€æ¡†æ ·å¼ */
        .view-description {
            background: var(--background-color);
            padding: var(--spacing-md);
            border-radius: var(--radius-md);
            margin-bottom: var(--spacing-lg);
            color: var(--text-secondary);
            font-size: var(--font-size-sm);
            border-left: 3px solid var(--primary-color);
        }

        body.dark-theme .view-description {
            background: var(--dark-background);
            color: var(--dark-text-secondary);
        }

        .view-content-wrapper {
            background: var(--background-color);
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            margin-bottom: var(--spacing-lg);
            max-height: 400px;
            overflow-y: auto;
        }

        body.dark-theme .view-content-wrapper {
            background: var(--dark-background);
        }

        .view-content {
            white-space: pre-wrap;
            word-wrap: break-word;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: var(--font-size-sm);
            line-height: 1.6;
            margin: 0;
            color: var(--text-primary);
        }

        body.dark-theme .view-content {
            color: var(--dark-text-primary);
        }

        .view-meta {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-md);
            font-size: var(--font-size-xs);
            color: var(--text-muted);
        }

        .view-meta-item {
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .view-tags {
            display: flex;
            flex-wrap: wrap;
            gap: var(--spacing-xs);
            margin-top: var(--spacing-sm);
        }

        .view-tag {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary-color);
            padding: 2px 8px;
            border-radius: var(--radius-sm);
            font-size: var(--font-size-xs);
        }

        /* è¡¨å•è¡Œæ ·å¼ */
        .form-row {
            display: flex;
            gap: var(--spacing-md);
        }

        .form-row .form-group {
            flex: 1;
            margin-bottom: var(--spacing-lg);
        }

        /* åˆ†ç±»é€‰æ‹©å™¨æ ·å¼ */
        .category-input-wrapper {
            position: relative;
            display: flex;
            gap: var(--spacing-sm);
        }

        .category-input-wrapper .form-control {
            flex: 1;
        }

        .category-select {
            width: auto;
            min-width: 120px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¤´éƒ¨ -->
        <header class="header">
            <div class="header-content">
                <div class="header-left">
                    <h1 class="header-title">ğŸ“ æç¤ºè¯ç®¡ç†å·¥å…·</h1>
                    <p class="header-subtitle">é«˜æ•ˆç®¡ç†å’Œç»„ç»‡ä½ çš„AIæç¤ºè¯</p>
                </div>
                <div class="header-controls">
                    <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
                    <div class="status-indicator" id="statusIndicator">
                        <span class="status-dot"></span>
                        <span id="statusText">æœªç™»å½•</span>
                    </div>
                    <!-- æ§åˆ¶æŒ‰é’®ç»„ -->
                    <div class="btn-group">
                        <button class="btn btn-secondary btn-sm" id="loginBtn" onclick="showLoginModal()">
                            ğŸ” ç™»å½•
                        </button>
                        <button class="btn btn-secondary btn-sm" id="syncBtn" onclick="syncToCloud()" style="display: none;">
                            â˜ï¸ åŒæ­¥
                        </button>
                        <button class="btn-icon" onclick="toggleTheme()" title="åˆ‡æ¢ä¸»é¢˜">
                            ğŸŒ™
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- å·¥å…·æ  -->
        <div class="toolbar">
            <!-- æœç´¢æ¡† -->
            <div class="search-box">
                <span class="search-icon">ğŸ”</span>
                <input type="text" class="search-input" placeholder="æœç´¢æç¤ºè¯..." id="searchInput" oninput="filterPrompts()">
            </div>

            <!-- ç­›é€‰ç»„ -->
            <div class="filter-group">
                <select class="select-control" id="visibilityFilter" onchange="filterPrompts()">
                    <option value="all">å…¨éƒ¨</option>
                    <option value="public">å…¬å¼€</option>
                    <option value="private">ç§å¯†</option>
                </select>

                <select class="select-control" id="categoryFilter" onchange="filterPrompts()">
                    <option value="all">å…¨éƒ¨åˆ†ç±»</option>
                </select>

                <select class="select-control" id="sortBy" onchange="sortPrompts()">
                    <option value="updated">æœ€è¿‘æ›´æ–°</option>
                    <option value="created">åˆ›å»ºæ—¶é—´</option>
                    <option value="name">åç§°</option>
                    <option value="usage">ä½¿ç”¨æ¬¡æ•°</option>
                </select>
            </div>

            <!-- æ“ä½œæŒ‰é’® -->
            <div class="btn-group">
                <button class="btn btn-primary" onclick="showAddPromptModal()">
                    â• æ–°å»ºæç¤ºè¯
                </button>
                <button class="btn btn-secondary" onclick="showImportModal()">
                    ğŸ“¥ å¯¼å…¥
                </button>
                <button class="btn btn-secondary" onclick="exportData()">
                    ğŸ“¤ å¯¼å‡º
                </button>
            </div>
        </div>

        <!-- æç¤ºè¯ç½‘æ ¼ -->
        <div class="prompts-grid" id="promptsGrid">
            <!-- æç¤ºè¯å¡ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>

        <!-- ç©ºçŠ¶æ€ -->
        <div class="empty-state" id="emptyState" style="display: none;">
            <div class="empty-icon">ğŸ“</div>
            <h3 class="empty-title">è¿˜æ²¡æœ‰æç¤ºè¯</h3>
            <p class="empty-text">ç‚¹å‡»"æ–°å»ºæç¤ºè¯"æŒ‰é’®åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªæç¤ºè¯</p>
        </div>
    </div>

    <!-- Toasté€šçŸ¥å®¹å™¨ -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- ç¼–è¾‘/æ–°å»ºæç¤ºè¯æ¨¡æ€æ¡† -->
    <div class="modal" id="promptModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">æ–°å»ºæç¤ºè¯</h2>
                <button class="modal-close" onclick="closeModal('promptModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <form id="promptForm" onsubmit="savePrompt(event)">
                    <div class="form-group">
                        <label class="form-label">æ ‡é¢˜ *</label>
                        <input type="text" class="form-control" id="promptTitle" required>
                    </div>

                    <div class="form-group">
                        <label class="form-label">æè¿°</label>
                        <input type="text" class="form-control" id="promptDescription" placeholder="ç®€å•ä»‹ç»ä¸€ä¸‹è¿™ä¸ªæç¤ºè¯çš„ç”¨é€”">
                        <span class="form-hint">å¯é€‰ï¼Œç”¨äºå¿«é€Ÿäº†è§£æç¤ºè¯ç”¨é€”</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">å†…å®¹ *</label>
                        <textarea class="form-control" id="promptContent" rows="8" required></textarea>
                        <span class="form-hint">æ”¯æŒMarkdownæ ¼å¼</span>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">åˆ†ç±»</label>
                            <div class="category-input-wrapper">
                                <input type="text" class="form-control" id="promptCategory" placeholder="è¾“å…¥æˆ–é€‰æ‹©åˆ†ç±»">
                                <select class="form-control category-select" id="categorySelect" onchange="selectCategory()">
                                    <option value="">é€‰æ‹©å·²æœ‰åˆ†ç±»</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">æ ‡ç­¾</label>
                            <input type="text" class="form-control" id="promptTags" placeholder="å¤šä¸ªæ ‡ç­¾ç”¨é€—å·ã€é¡¿å·æˆ–ç©ºæ ¼åˆ†éš”">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="checkbox-group">
                                <input type="checkbox" class="checkbox" id="promptPrivate">
                                <span class="form-label" style="margin: 0;">ğŸ”’ ç§å¯†ï¼ˆä»…ç™»å½•åå¯è§ï¼‰</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-group">
                                <input type="checkbox" class="checkbox" id="promptPinned">
                                <span class="form-label" style="margin: 0;">ğŸ“Œ ç½®é¡¶</span>
                            </label>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('promptModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="document.getElementById('promptForm').requestSubmit()">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- ç™»å½•æ¨¡æ€æ¡† -->
    <div class="modal" id="loginModal">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h2 class="modal-title">ç™»å½•</h2>
                <button class="modal-close" onclick="closeModal('loginModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <form id="loginForm" onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label class="form-label">å¯†ç </label>
                        <input type="password" class="form-control" id="loginPassword" required>
                        <span class="form-hint">è¾“å…¥äº‘ç«¯åŒæ­¥å¯†ç </span>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('loginModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="document.getElementById('loginForm').requestSubmit()">ç™»å½•</button>
            </div>
        </div>
    </div>

    <!-- å¯¼å…¥æ¨¡æ€æ¡† -->
    <div class="modal" id="importModal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title">å¯¼å…¥æ•°æ®</h2>
                <button class="modal-close" onclick="closeModal('importModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">é€‰æ‹©æ–‡ä»¶</label>
                    <input type="file" class="form-control" id="importFile" accept=".json">
                    <span class="form-hint">æ”¯æŒJSONæ ¼å¼çš„æ•°æ®æ–‡ä»¶</span>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('importModal')">å–æ¶ˆ</button>
                <button class="btn btn-primary" onclick="handleImport()">å¯¼å…¥</button>
            </div>
        </div>
    </div>

    <!-- æç¤ºè¯è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal" id="viewModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title" id="viewModalTitle">æç¤ºè¯è¯¦æƒ…</h2>
                <button class="modal-close" onclick="closeModal('viewModal')">âœ•</button>
            </div>
            <div class="modal-body">
                <div id="viewDescription" class="view-description" style="display: none;"></div>
                <div class="view-content-wrapper">
                    <pre class="view-content" id="viewContent"></pre>
                </div>
                <div class="view-meta" id="viewMeta"></div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('viewModal')">å…³é—­</button>
                <button class="btn btn-secondary" onclick="editPromptFromView()">âœï¸ ç¼–è¾‘</button>
                <button class="btn btn-primary" onclick="copyFromView()">ğŸ“‹ å¤åˆ¶å†…å®¹</button>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let appData = {
            prompts: [],
            settings: {
                theme: 'light'
            }
        };

        let authState = {
            isLoggedIn: false,
            token: localStorage.getItem('authToken') || null,
            lastSync: null
        };

        let editingPromptId = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initTheme();
            loadData();
            renderPrompts();
            updateCategories();
            checkAuth();
        });

        // ä¸»é¢˜åˆ‡æ¢
        function initTheme() {
            const savedTheme = localStorage.getItem('promptManagerTheme') || 'light';
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                document.querySelector('.btn-icon').textContent = 'â˜€ï¸';
            }
            appData.settings.theme = savedTheme;
        }

        function toggleTheme() {
            const isDark = document.body.classList.contains('dark-theme');
            if (isDark) {
                document.body.classList.remove('dark-theme');
                document.querySelector('.btn-icon').textContent = 'ğŸŒ™';
                appData.settings.theme = 'light';
            } else {
                document.body.classList.add('dark-theme');
                document.querySelector('.btn-icon').textContent = 'â˜€ï¸';
                appData.settings.theme = 'dark';
            }
            localStorage.setItem('promptManagerTheme', appData.settings.theme);
            saveData();
        }

        // æ•°æ®ç®¡ç†
        function saveData() {
            try {
                localStorage.setItem('promptManagerData', JSON.stringify(appData));
                if (authState.isLoggedIn) {
                    // è§¦å‘äº‘ç«¯åŒæ­¥ï¼ˆå»¶è¿Ÿ1ç§’ï¼‰
                    clearTimeout(window.syncTimeout);
                    window.syncTimeout = setTimeout(() => syncToCloud(true), 1000);
                }
            } catch (error) {
                showToast('ä¿å­˜å¤±è´¥', error.message, 'error');
            }
        }

        function loadData() {
            try {
                const saved = localStorage.getItem('promptManagerData');
                if (saved) {
                    appData = JSON.parse(saved);
                    // ç¡®ä¿æ•°æ®ç»“æ„å®Œæ•´
                    if (!appData.prompts) appData.prompts = [];
                    if (!appData.settings) appData.settings = { theme: 'light' };
                }
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
                appData = { prompts: [], settings: { theme: 'light' } };
            }
        }

        // æ¸²æŸ“æç¤ºè¯
        function renderPrompts() {
            const grid = document.getElementById('promptsGrid');
            const emptyState = document.getElementById('emptyState');

            console.log('=== DEBUG renderPrompts ===');
            console.log('ç™»å½•çŠ¶æ€:', authState.isLoggedIn);

            // è·å–ç­›é€‰åçš„æç¤ºè¯
            let prompts = getFilteredPrompts();

            console.log('ç­›é€‰åæç¤ºè¯æ•°é‡:', prompts.length);

            // åº”ç”¨æ’åº
            prompts = sortPromptsList(prompts);

            if (prompts.length === 0) {
                console.log('æ²¡æœ‰æç¤ºè¯,æ˜¾ç¤ºç©ºçŠ¶æ€');
                grid.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';

            let renderedCount = 0;
            grid.innerHTML = prompts.map(prompt => {
                const isPrivate = prompt.isPrivate === true; // æ˜ç¡®åˆ¤æ–­æ˜¯å¦ä¸ºç§å¯†
                const isPinned = prompt.isPinned || false;
                const category = prompt.category || 'æœªåˆ†ç±»';
                const tags = prompt.tags || [];
                const usage = prompt.usage || 0;
                const updatedAt = prompt.updatedAt ? new Date(prompt.updatedAt).toLocaleDateString() : '';

                // æœªç™»å½•æ—¶éšè—ç§å¯†æç¤ºè¯(åªéšè—isPrivate=trueçš„)
                if (isPrivate && !authState.isLoggedIn) {
                    console.log('éšè—ç§å¯†æç¤ºè¯:', prompt.title);
                    return '';
                }

                renderedCount++;
                if (renderedCount === 1) {
                    console.log('æ¸²æŸ“ç¬¬ä¸€ä¸ªæç¤ºè¯:', prompt.title, '| isPrivate:', isPrivate);
                }

                return `
                    <div class="prompt-card ${isPrivate ? 'private' : 'public'}" onclick="viewPrompt('${prompt.id}')">
                        <div class="prompt-header">
                            <h3 class="prompt-title">${escapeHtml(prompt.title)}</h3>
                            <div class="prompt-badges">
                                ${isPinned ? '<span class="badge badge-pinned">ğŸ“Œ</span>' : ''}
                                <span class="badge ${isPrivate ? 'badge-private' : 'badge-public'}">
                                    ${isPrivate ? 'ğŸ”’ ç§å¯†' : 'ğŸŒ å…¬å¼€'}
                                </span>
                            </div>
                        </div>
                        <div class="prompt-content">${escapeHtml(prompt.content)}</div>
                        <div class="prompt-footer">
                            <div class="prompt-meta">
                                <span>ğŸ“ ${escapeHtml(category)}</span>
                                <span>ğŸ‘ï¸ ${usage}</span>
                                ${updatedAt ? `<span>ğŸ“… ${updatedAt}</span>` : ''}
                            </div>
                            <div class="prompt-actions" onclick="event.stopPropagation()">
                                <button class="btn btn-secondary btn-sm" onclick="copyPromptContent('${prompt.id}')" title="å¤åˆ¶">
                                    ğŸ“‹
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="editPrompt('${prompt.id}')" title="ç¼–è¾‘">
                                    âœï¸
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="deletePrompt('${prompt.id}')" title="åˆ é™¤">
                                    ğŸ—‘ï¸
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            console.log('å®é™…æ¸²æŸ“çš„æç¤ºè¯æ•°é‡:', renderedCount);
            console.log('=== renderPrompts END ===');
        }

        // ç­›é€‰æç¤ºè¯
        function getFilteredPrompts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const visibilityFilter = document.getElementById('visibilityFilter').value;
            const categoryFilter = document.getElementById('categoryFilter').value;

            console.log('=== DEBUG getFilteredPrompts ===');
            console.log('æ€»æç¤ºè¯æ•°é‡:', appData.prompts.length);
            console.log('å¯è§æ€§ç­›é€‰å™¨:', visibilityFilter);
            console.log('ç™»å½•çŠ¶æ€:', authState.isLoggedIn);

            const filtered = appData.prompts.filter(prompt => {
                // æœç´¢è¿‡æ»¤
                const matchesSearch = !searchTerm ||
                    prompt.title.toLowerCase().includes(searchTerm) ||
                    prompt.content.toLowerCase().includes(searchTerm) ||
                    (prompt.category && prompt.category.toLowerCase().includes(searchTerm));

                // å¯è§æ€§è¿‡æ»¤ - æ˜ç¡®åˆ¤æ–­,æœªè®¾ç½®isPrivateçš„è§†ä¸ºå…¬å¼€
                const isPrivate = prompt.isPrivate === true;

                // å¦‚æœç”¨æˆ·é€‰æ‹©äº†ç­›é€‰æ¡ä»¶,åˆ™åº”ç”¨ç­›é€‰
                // å¦‚æœæ˜¯"å…¨éƒ¨",åˆ™ä¸è¿‡æ»¤(åç»­åœ¨renderPromptsä¸­æ ¹æ®ç™»å½•çŠ¶æ€å†³å®šæ˜¯å¦æ˜¾ç¤º)
                let matchesVisibility = true;
                if (visibilityFilter === 'public') {
                    matchesVisibility = !isPrivate;
                } else if (visibilityFilter === 'private') {
                    matchesVisibility = isPrivate;
                }
                // visibilityFilter === 'all' æ—¶,matchesVisibility ä¿æŒä¸º true

                // åˆ†ç±»è¿‡æ»¤
                const matchesCategory = categoryFilter === 'all' ||
                    prompt.category === categoryFilter;

                const result = matchesSearch && matchesVisibility && matchesCategory;

                // è°ƒè¯•ç¬¬ä¸€ä¸ªæç¤ºè¯
                if (prompt === appData.prompts[0]) {
                    console.log('ç¬¬ä¸€ä¸ªæç¤ºè¯è°ƒè¯•:');
                    console.log('  æ ‡é¢˜:', prompt.title);
                    console.log('  isPrivateå­—æ®µå€¼:', prompt.isPrivate);
                    console.log('  isPrivate === true:', isPrivate);
                    console.log('  matchesSearch:', matchesSearch);
                    console.log('  matchesVisibility:', matchesVisibility);
                    console.log('  matchesCategory:', matchesCategory);
                    console.log('  æœ€ç»ˆç»“æœ:', result);
                }

                return result;
            });

            console.log('ç­›é€‰åæ•°é‡:', filtered.length);
            console.log('=== DEBUG END ===');

            return filtered;
        }

        // æ’åºæç¤ºè¯
        function sortPromptsList(prompts) {
            const sortBy = document.getElementById('sortBy').value;

            const sorted = [...prompts].sort((a, b) => {
                // ç½®é¡¶çš„æ€»æ˜¯åœ¨å‰é¢
                if (a.isPinned && !b.isPinned) return -1;
                if (!a.isPinned && b.isPinned) return 1;

                // æŒ‰é€‰æ‹©çš„æ’åºæ–¹å¼æ’åº
                switch (sortBy) {
                    case 'updated':
                        return new Date(b.updatedAt || 0) - new Date(a.updatedAt || 0);
                    case 'created':
                        return new Date(b.createdAt || 0) - new Date(a.createdAt || 0);
                    case 'name':
                        return a.title.localeCompare(b.title);
                    case 'usage':
                        return (b.usage || 0) - (a.usage || 0);
                    default:
                        return 0;
                }
            });

            return sorted;
        }

        // ç­›é€‰å’Œæ’åº
        function filterPrompts() {
            renderPrompts();
        }

        function sortPrompts() {
            renderPrompts();
        }

        // æ›´æ–°åˆ†ç±»ä¸‹æ‹‰åˆ—è¡¨
        function updateCategories() {
            const categories = [...new Set(appData.prompts.map(p => p.category).filter(Boolean))];
            const categoryFilter = document.getElementById('categoryFilter');
            const categorySelect = document.getElementById('categorySelect');

            // æ›´æ–°ç­›é€‰ä¸‹æ‹‰
            const currentValue = categoryFilter.value;
            categoryFilter.innerHTML = '<option value="all">å…¨éƒ¨åˆ†ç±»</option>' +
                categories.map(cat => `<option value="${escapeHtml(cat)}">${escapeHtml(cat)}</option>`).join('');
            categoryFilter.value = currentValue;

            // æ›´æ–°ç¼–è¾‘è¡¨å•çš„åˆ†ç±»é€‰æ‹©å™¨
            categorySelect.innerHTML = '<option value="">é€‰æ‹©å·²æœ‰åˆ†ç±»</option>' +
                categories.map(cat => `<option value="${escapeHtml(cat)}">${escapeHtml(cat)}</option>`).join('');
        }

        // é€‰æ‹©å·²æœ‰åˆ†ç±»
        function selectCategory() {
            const categorySelect = document.getElementById('categorySelect');
            const categoryInput = document.getElementById('promptCategory');
            if (categorySelect.value) {
                categoryInput.value = categorySelect.value;
                categorySelect.value = ''; // é‡ç½®é€‰æ‹©å™¨
            }
        }

        // æ¨¡æ€æ¡†æ“ä½œ
        function showAddPromptModal() {
            editingPromptId = null;
            document.getElementById('modalTitle').textContent = 'æ–°å»ºæç¤ºè¯';
            document.getElementById('promptForm').reset();
            document.getElementById('categorySelect').value = '';
            updateCategories(); // ç¡®ä¿åˆ†ç±»é€‰æ‹©å™¨æ˜¯æœ€æ–°çš„
            showModal('promptModal');
        }

        function editPrompt(id) {
            const prompt = appData.prompts.find(p => p.id === id);
            if (!prompt) return;

            editingPromptId = id;
            document.getElementById('modalTitle').textContent = 'ç¼–è¾‘æç¤ºè¯';
            document.getElementById('promptTitle').value = prompt.title;
            document.getElementById('promptDescription').value = prompt.description || '';
            document.getElementById('promptContent').value = prompt.content;
            document.getElementById('promptCategory').value = prompt.category || '';
            document.getElementById('promptTags').value = (prompt.tags || []).join(', ');
            document.getElementById('promptPrivate').checked = prompt.isPrivate || false;
            document.getElementById('promptPinned').checked = prompt.isPinned || false;
            document.getElementById('categorySelect').value = '';

            updateCategories(); // ç¡®ä¿åˆ†ç±»é€‰æ‹©å™¨æ˜¯æœ€æ–°çš„
            showModal('promptModal');
        }

        // å½“å‰æŸ¥çœ‹çš„æç¤ºè¯ID
        let viewingPromptId = null;

        function viewPrompt(id) {
            const prompt = appData.prompts.find(p => p.id === id);
            if (!prompt) return;

            viewingPromptId = id;

            // å¢åŠ ä½¿ç”¨æ¬¡æ•°
            prompt.usage = (prompt.usage || 0) + 1;
            saveData();

            // æ˜¾ç¤ºè¯¦æƒ…æ¨¡æ€æ¡†
            document.getElementById('viewModalTitle').textContent = prompt.title;
            document.getElementById('viewContent').textContent = prompt.content;

            // æ˜¾ç¤ºæè¿°ï¼ˆå¦‚æœæœ‰ï¼‰
            const descriptionEl = document.getElementById('viewDescription');
            if (prompt.description) {
                descriptionEl.textContent = prompt.description;
                descriptionEl.style.display = 'block';
            } else {
                descriptionEl.style.display = 'none';
            }

            // æ„å»ºå…ƒä¿¡æ¯
            const category = prompt.category || 'æœªåˆ†ç±»';
            const usage = prompt.usage || 0;
            const createdAt = prompt.createdAt ? new Date(prompt.createdAt).toLocaleDateString() : '';
            const updatedAt = prompt.updatedAt ? new Date(prompt.updatedAt).toLocaleDateString() : '';
            const tags = prompt.tags || [];
            const isPrivate = prompt.isPrivate === true; // æ˜ç¡®åˆ¤æ–­

            let metaHtml = `
                <span class="view-meta-item">ğŸ“ ${escapeHtml(category)}</span>
                <span class="view-meta-item">ğŸ‘ï¸ ä½¿ç”¨ ${usage} æ¬¡</span>
                ${createdAt ? `<span class="view-meta-item">ğŸ“… åˆ›å»ºäº ${createdAt}</span>` : ''}
                ${updatedAt ? `<span class="view-meta-item">ğŸ”„ æ›´æ–°äº ${updatedAt}</span>` : ''}
                <span class="view-meta-item">${isPrivate ? 'ğŸ”’ ç§å¯†' : 'ğŸŒ å…¬å¼€'}</span>
            `;

            if (tags.length > 0) {
                metaHtml += `<div class="view-tags">${tags.map(tag => `<span class="view-tag">${escapeHtml(tag)}</span>`).join('')}</div>`;
            }

            document.getElementById('viewMeta').innerHTML = metaHtml;

            showModal('viewModal');
            renderPrompts(); // æ›´æ–°ä½¿ç”¨æ¬¡æ•°æ˜¾ç¤º
        }

        function editPromptFromView() {
            if (viewingPromptId) {
                closeModal('viewModal');
                editPrompt(viewingPromptId);
            }
        }

        function copyFromView() {
            const prompt = appData.prompts.find(p => p.id === viewingPromptId);
            if (!prompt) return;

            navigator.clipboard.writeText(prompt.content).then(() => {
                showToast('å¤åˆ¶æˆåŠŸ', 'æç¤ºè¯å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
            }).catch(err => {
                showToast('å¤åˆ¶å¤±è´¥', err.message, 'error');
            });
        }

        function copyPromptContent(id) {
            const prompt = appData.prompts.find(p => p.id === id);
            if (!prompt) return;

            navigator.clipboard.writeText(prompt.content).then(() => {
                showToast('å¤åˆ¶æˆåŠŸ', 'æç¤ºè¯å†…å®¹å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                // å¢åŠ ä½¿ç”¨æ¬¡æ•°
                prompt.usage = (prompt.usage || 0) + 1;
                saveData();
                renderPrompts();
            }).catch(err => {
                showToast('å¤åˆ¶å¤±è´¥', err.message, 'error');
            });
        }

        function deletePrompt(id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæç¤ºè¯å—ï¼Ÿ')) return;

            appData.prompts = appData.prompts.filter(p => p.id !== id);
            saveData();
            renderPrompts();
            updateCategories();
            showToast('åˆ é™¤æˆåŠŸ', 'æç¤ºè¯å·²åˆ é™¤', 'success');
        }

        function savePrompt(event) {
            event.preventDefault();

            const title = document.getElementById('promptTitle').value.trim();
            const description = document.getElementById('promptDescription').value.trim();
            const content = document.getElementById('promptContent').value.trim();
            const category = document.getElementById('promptCategory').value.trim();
            const tagsStr = document.getElementById('promptTags').value.trim();
            // æ”¯æŒå¤šç§åˆ†éš”ç¬¦ï¼šé€—å·ã€é¡¿å·ã€åˆ†å·ã€ç©ºæ ¼
            const tags = tagsStr ? tagsStr.split(/[,ï¼Œã€;ï¼›\s]+/).map(t => t.trim()).filter(Boolean) : [];
            const isPrivate = document.getElementById('promptPrivate').checked;
            const isPinned = document.getElementById('promptPinned').checked;

            if (!title || !content) {
                showToast('ä¿å­˜å¤±è´¥', 'æ ‡é¢˜å’Œå†…å®¹ä¸èƒ½ä¸ºç©º', 'error');
                return;
            }

            if (editingPromptId) {
                // ç¼–è¾‘ç°æœ‰æç¤ºè¯
                const prompt = appData.prompts.find(p => p.id === editingPromptId);
                if (prompt) {
                    prompt.title = title;
                    prompt.description = description;
                    prompt.content = content;
                    prompt.category = category;
                    prompt.tags = tags;
                    prompt.isPrivate = isPrivate;
                    prompt.isPinned = isPinned;
                    prompt.updatedAt = new Date().toISOString();
                }
            } else {
                // æ–°å»ºæç¤ºè¯
                const newPrompt = {
                    id: generateId(),
                    title,
                    description,
                    content,
                    category,
                    tags,
                    isPrivate,
                    isPinned,
                    usage: 0,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                appData.prompts.push(newPrompt);
            }

            saveData();
            renderPrompts();
            updateCategories();
            closeModal('promptModal');
            showToast('ä¿å­˜æˆåŠŸ', editingPromptId ? 'æç¤ºè¯å·²æ›´æ–°' : 'æç¤ºè¯å·²åˆ›å»º', 'success');
        }

        // ç™»å½•è®¤è¯
        function checkAuth() {
            if (authState.token) {
                // éªŒè¯token
                verifyToken();
            }
        }

        async function verifyToken() {
            try {
                const response = await fetch('/api/auth/verify', {
                    headers: {
                        'Authorization': `Bearer ${authState.token}`
                    }
                });

                if (response.ok) {
                    authState.isLoggedIn = true;
                    updateAuthUI();
                    await loadFromCloud(true);
                } else {
                    // Token æ— æ•ˆï¼Œæ¸…é™¤
                    logout();
                }
            } catch (error) {
                console.error('éªŒè¯å¤±è´¥:', error);
                // ç½‘ç»œé”™è¯¯æ—¶ä¿æŒç™»å½•çŠ¶æ€ï¼Œä½¿ç”¨æœ¬åœ°ç¼“å­˜
                authState.isLoggedIn = true;
                updateAuthUI();
            }
        }

        function showLoginModal() {
            showModal('loginModal');
        }

        async function handleLogin(event) {
            event.preventDefault();

            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    authState.token = result.token;
                    authState.isLoggedIn = true;
                    localStorage.setItem('authToken', result.token);

                    updateAuthUI();
                    closeModal('loginModal');
                    showToast('ç™»å½•æˆåŠŸ', 'å·²è¿æ¥åˆ°äº‘ç«¯', 'success');

                    // åŠ è½½äº‘ç«¯æ•°æ®
                    await loadFromCloud();
                } else {
                    showToast('ç™»å½•å¤±è´¥', result.error || 'å¯†ç é”™è¯¯', 'error');
                }
            } catch (error) {
                showToast('ç™»å½•å¤±è´¥', 'æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨', 'error');
            }
        }

        function logout() {
            authState.isLoggedIn = false;
            authState.token = null;
            localStorage.removeItem('authToken');
            updateAuthUI();
            renderPrompts(); // é‡æ–°æ¸²æŸ“ä»¥éšè—ç§å¯†æç¤ºè¯
            showToast('å·²é€€å‡º', 'å·²é€€å‡ºç™»å½•', 'info');
        }

        function updateAuthUI() {
            const loginBtn = document.getElementById('loginBtn');
            const syncBtn = document.getElementById('syncBtn');
            const statusIndicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            const statusDot = statusIndicator.querySelector('.status-dot');

            if (authState.isLoggedIn) {
                loginBtn.textContent = 'ğŸšª é€€å‡º';
                loginBtn.onclick = logout;
                syncBtn.style.display = 'inline-flex';
                statusDot.classList.add('online');
                statusText.textContent = 'å·²ç™»å½•';

                if (authState.lastSync) {
                    const syncTime = new Date(authState.lastSync).toLocaleTimeString();
                    statusText.textContent = `å·²åŒæ­¥ ${syncTime}`;
                }
            } else {
                loginBtn.textContent = 'ğŸ” ç™»å½•';
                loginBtn.onclick = showLoginModal;
                syncBtn.style.display = 'none';
                statusDot.classList.remove('online');
                statusText.textContent = 'æœªç™»å½•';
            }
        }

        // äº‘ç«¯åŒæ­¥
        async function syncToCloud(silent = false) {
            if (!authState.isLoggedIn) {
                if (!silent) showToast('åŒæ­¥å¤±è´¥', 'è¯·å…ˆç™»å½•', 'error');
                return;
            }

            try {
                // æ˜¾ç¤ºåŒæ­¥ä¸­çŠ¶æ€
                const syncBtn = document.getElementById('syncBtn');
                const originalText = syncBtn.innerHTML;
                syncBtn.innerHTML = '<span class="loading"></span> åŒæ­¥ä¸­';
                syncBtn.disabled = true;

                const response = await fetch('/api/data/sync', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authState.token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(appData)
                });

                syncBtn.innerHTML = originalText;
                syncBtn.disabled = false;

                if (response.ok) {
                    const result = await response.json();
                    if (result.success) {
                        authState.lastSync = new Date().toISOString();
                        updateAuthUI();
                        if (!silent) showToast('åŒæ­¥æˆåŠŸ', 'æ•°æ®å·²åŒæ­¥åˆ°äº‘ç«¯', 'success');
                    } else {
                        if (!silent) showToast('åŒæ­¥å¤±è´¥', result.error || 'æœªçŸ¥é”™è¯¯', 'error');
                    }
                } else {
                    if (response.status === 401) {
                        logout();
                        if (!silent) showToast('åŒæ­¥å¤±è´¥', 'ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•', 'error');
                    } else {
                        if (!silent) showToast('åŒæ­¥å¤±è´¥', 'æœåŠ¡å™¨é”™è¯¯', 'error');
                    }
                }
            } catch (error) {
                const syncBtn = document.getElementById('syncBtn');
                syncBtn.innerHTML = 'â˜ï¸ åŒæ­¥';
                syncBtn.disabled = false;
                if (!silent) showToast('åŒæ­¥å¤±è´¥', 'æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨', 'error');
            }
        }

        async function loadFromCloud(silent = false) {
            if (!authState.isLoggedIn) {
                if (!silent) showToast('åŠ è½½å¤±è´¥', 'è¯·å…ˆç™»å½•', 'error');
                return;
            }

            try {
                const response = await fetch('/api/data/load', {
                    headers: {
                        'Authorization': `Bearer ${authState.token}`
                    }
                });

                if (response.ok) {
                    const result = await response.json();

                    if (result.data) {
                        const cloudData = result.data;

                        // åˆå¹¶æ•°æ®ï¼šäº‘ç«¯æ•°æ®ä¼˜å…ˆï¼Œä½†ä¿ç•™æœ¬åœ°ç‹¬æœ‰çš„æ•°æ®
                        if (cloudData.prompts && Array.isArray(cloudData.prompts)) {
                            // åˆ›å»ºäº‘ç«¯æç¤ºè¯çš„ ID é›†åˆ
                            const cloudIds = new Set(cloudData.prompts.map(p => p.id));
                            // ä¿ç•™æœ¬åœ°ç‹¬æœ‰çš„æç¤ºè¯
                            const localOnlyPrompts = appData.prompts.filter(p => !cloudIds.has(p.id));

                            // åˆå¹¶ï¼šäº‘ç«¯æ•°æ® + æœ¬åœ°ç‹¬æœ‰æ•°æ®
                            appData.prompts = [...cloudData.prompts, ...localOnlyPrompts];

                            if (cloudData.settings) {
                                appData.settings = { ...appData.settings, ...cloudData.settings };
                            }

                            saveData();
                            renderPrompts();
                            updateCategories();
                        }

                        authState.lastSync = result.lastSync ? new Date(result.lastSync).toISOString() : new Date().toISOString();
                        updateAuthUI();
                        if (!silent) showToast('åŠ è½½æˆåŠŸ', 'å·²ä»äº‘ç«¯åŠ è½½æ•°æ®', 'success');
                    } else {
                        // äº‘ç«¯æ²¡æœ‰æ•°æ®ï¼Œä¸Šä¼ æœ¬åœ°æ•°æ®
                        if (!silent) showToast('æç¤º', 'äº‘ç«¯æš‚æ— æ•°æ®ï¼Œå°†ä¸Šä¼ æœ¬åœ°æ•°æ®', 'info');
                        await syncToCloud(silent);
                    }
                } else {
                    if (response.status === 401) {
                        logout();
                        if (!silent) showToast('åŠ è½½å¤±è´¥', 'ç™»å½•å·²è¿‡æœŸï¼Œè¯·é‡æ–°ç™»å½•', 'error');
                    } else {
                        if (!silent) showToast('åŠ è½½å¤±è´¥', 'æœåŠ¡å™¨é”™è¯¯', 'error');
                    }
                }
            } catch (error) {
                if (!silent) showToast('åŠ è½½å¤±è´¥', 'æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨', 'error');
            }
        }

        // å¯¼å…¥å¯¼å‡º
        function showImportModal() {
            showModal('importModal');
        }

        function handleImport() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];

            if (!file) {
                showToast('å¯¼å…¥å¤±è´¥', 'è¯·é€‰æ‹©æ–‡ä»¶', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);

                    if (imported.prompts && Array.isArray(imported.prompts)) {
                        // åˆå¹¶æ•°æ®
                        imported.prompts.forEach(prompt => {
                            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨
                            const exists = appData.prompts.find(p => p.id === prompt.id);
                            if (!exists) {
                                appData.prompts.push(prompt);
                            }
                        });

                        saveData();
                        renderPrompts();
                        updateCategories();
                        closeModal('importModal');
                        showToast('å¯¼å…¥æˆåŠŸ', `å·²å¯¼å…¥ ${imported.prompts.length} ä¸ªæç¤ºè¯`, 'success');
                    } else {
                        showToast('å¯¼å…¥å¤±è´¥', 'æ— æ•ˆçš„æ•°æ®æ ¼å¼', 'error');
                    }
                } catch (error) {
                    showToast('å¯¼å…¥å¤±è´¥', error.message, 'error');
                }
            };
            reader.readAsText(file);
        }

        function exportData() {
            const dataStr = JSON.stringify(appData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);

            const link = document.createElement('a');
            link.href = url;
            link.download = `prompts-${new Date().toISOString().split('T')[0]}.json`;
            link.click();

            URL.revokeObjectURL(url);
            showToast('å¯¼å‡ºæˆåŠŸ', 'æ•°æ®å·²å¯¼å‡º', 'success');
        }

        // å·¥å…·å‡½æ•°
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('show');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }

        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function showToast(title, message, type = 'info') {
            const container = document.getElementById('toastContainer');

            const icons = {
                success: 'âœ…',
                error: 'âŒ',
                warning: 'âš ï¸',
                info: 'â„¹ï¸'
            };

            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <span class="toast-icon">${icons[type] || icons.info}</span>
                <div class="toast-content">
                    <div class="toast-title">${escapeHtml(title)}</div>
                    <div class="toast-message">${escapeHtml(message)}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">âœ•</button>
            `;

            container.appendChild(toast);

            // 3ç§’åè‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                toast.style.animation = 'toastSlideIn 0.3s ease-out reverse';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // é¡µé¢é€€å‡ºå‰åŒæ­¥
        window.addEventListener('beforeunload', function() {
            if (authState.isLoggedIn) {
                syncToCloud(true);
            }
        });

        // å®šæœŸè‡ªåŠ¨åŒæ­¥ï¼ˆæ¯5åˆ†é’Ÿï¼‰
        setInterval(() => {
            if (authState.isLoggedIn) {
                syncToCloud(true);
            }
        }, 5 * 60 * 1000);
    </script>
</body>
</html>
